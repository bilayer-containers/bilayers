inputs:
  # Hardware Arguments
  - name: use_gpu
    type: Checkbox
    label: "Use GPU"
    description: "use GPU for processing"
    value: False
    cli_tag: "--use_gpu"
    section_id: "hardware-args"
    mode: "advanced"
  - name: gpu_device
    type: Number
    label: "GPU Device"
    description: "which GPU device to use - Integer for torch or mps for M1"
    default: 0
    cli_tag: "--gpu_device"
    interactive: True
    optional: True
    section_id: "hardware-args"
    mode: "advanced"
 
  # Input Image Arguments
  - name: dir
    type: Files
    label: "Input Image Directory"
    description: "Path to the directory of input images"
    file_count: "directory"
    default: "directory"
    cli_tag: "--dir"
    section_id: "input-args"
    mode: "beginner"
  - name: look_one_level_down
    type: Checkbox
    label: "Look One Level Down"
    description: "look one level down in folder structure for images"
    value: False
    cli_tag: "--look_one_level_down"
    optional: True
    section_id: "input-args"
    mode: "advanced"
  - name: image_filter
    type: Textbox
    label: "Image Filter"
    description: "filter for image files"
    default: ""
    cli_tag: "--img_filter"
    optional: True
    section_id: "input-args"
    mode: "advanced" 
  - name: channel_axis
    type: Radio
    label: "Channel Axis"
    description: "axis of image which corresponds to image channels"
    options: 
      - label: 0 
        value: 0
      - label: 2
        value: 2
    default: 0
    cli_tag: "--channel_axis"
    optional: True
    section_id: "input-args"
    mode: "advanced"
  - name: chan
    type: Radio
    label: "Chan To Segment"
    description: "channel to segment"
    options: 
      - label: GRAY 
        value: 0
      - label: RED
        value: 1
      - label: GREEN
        value: 2
      - label: BLUE
        value: 3
    default: 0
    cli_tag: "--chan"
    optional: False
    section_id: "input-args"
    mode: "beginner"
  - name: chan2
    type: Radio
    label: "Chan2"
    description: "Nuclear Channel, if cyto then optional"
    options: 
      - label: None 
        value: 0
      - label: RED
        value: 1
      - label: GREEN
        value: 2
      - label: BLUE
        value: 3
    default: 0
    cli_tag: "--chan2"
    optional: True
    section_id: "input-args"
    mode: "advanced"
  - name: invert
    type: Checkbox
    label: "Invert"
    description: "invert grayscale channel"
    value: False
    cli_tag: "--invert"
    optional: True
    section_id: "input-args"
    mode: "advanced"
  - name: all_channels
    type: Checkbox
    label: "All Channels"
    description: "use all channels in image"
    value: False
    cli_tag: "--all_channels"
    optional: True
    section_id: "input-args"
    mode: "advanced"  

  # Model Arguments
  - type: Radio
    label: "PreTrained Model"
    description: "type of model to use"
    options: 
      - label: Cyto
        value: "cyto"
      - label: Nuclei
        value: "nuclei"
      - label: Cyto2
        value: "cyto2"  
    default: "cyto"
    cli_tag: "--pretrained_model"
    optional: False
    section_id: "model-args"
    mode: "beginner"
  - type: Files
    label: "Add Model"
    description: "add custom model to use"
    file_count: "single"
    default: "single"
    cli_tag: "--add_model"
    optional: True
    section_id: "model-args"
    mode: "advanced"

    # Algorithm Arguments
  - name: no_resample
    type: Checkbox
    label: "No Resample"
    description: "do not resample image"
    value: False
    cli_tag: "--no_resample"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: no_interp
    type: Checkbox
    label: "No Interp"
    description: "do not interpolate image"
    value: False
    cli_tag: "--no_interp"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: no_norm
    type: Checkbox
    label: "No Norm"
    description: "do not normalize image"
    value: False
    cli_tag: "--no_norm"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: do_3D
    type: Checkbox
    label: "Do 3D"
    description: "process 3D image"
    value: False
    cli_tag: "--do_3D"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: diameter
    type: Number
    label: "Diameter"
    description: "estimated diameter of cells in pixels"
    default: 30
    cli_tag: "--diameter"
    optional: True
    section_id: "algorithm-args"
    mode: "beginner"
  - name: stitch_threshold
    type: Number
    label: "Stitch Threshold"
    description: "stitching threshold"
    default: 0.0
    cli_tag: "--stitch_threshold"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: min_size
    type: Number
    label: "Min Size"
    description: "minimum size of objects in pixels"
    default: 15
    cli_tag: "--min_size"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: fast_mode
    type: Checkbox
    label: "Fast Mode"
    description: "fast mode"
    value: False
    cli_tag: "--fast_mode"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: flow_threshold
    type: Number
    label: "Flow Threshold"
    description: "flow error threshold"
    default: 0.4
    cli_tag: "--flow_threshold"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: cellprob_threshold
    type: Number
    label: "Cellprob Threshold"
    description: "cell probability threshold"
    default: 0.0
    cli_tag: "--cellprob_threshold"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"
  - name: exclude_on_edges
    type: Checkbox
    label: "Exclude On Edges"
    description: "exclude cells on edges"
    value: False
    cli_tag: "--exclude_on_edges"
    optional: True
    section_id: "algorithm-args"
    mode: "advanced"

# Output Arguments
  - name: save_png
    type: Checkbox
    label: "Save PNG"
    description: "save segmentation as PNG"
    value: False
    cli_tag: "--save_png"
    optional: True
    section_id: "output-args"
    mode: "beginner"
  - name: save_tif
    type: Checkbox
    label: "Save TIF"
    description: "save segmentation as TIF"
    value: False
    cli_tag: "--save_tif"
    optional: True
    section_id: "output-args"
    mode: "beginner"
  - name: no_npy
    type: Checkbox
    label: "No NPY"
    description: "do not save npy"
    value: False
    cli_tag: "--no_npy"
    optional: True
    section_id: "output-args"
    mode: "advanced"
  - name: dir_above
    type: Checkbox
    label: "Dir Above"
    description: "save output in directory above"
    value: False
    cli_tag: "--dir_above"
    optional: True
    section_id: "output-args" 
    mode: "advanced"
  - name: in_folders
    type: Checkbox
    label: "In Folders"
    description: "save output in folders"
    value: False
    cli_tag: "--in_folders"
    optional: True
    section_id: "output-args"
    mode: "advanced"
  - name: save_flows  
    type: Checkbox
    label: "Save Flows"
    description: "save flows"
    value: False
    cli_tag: "--save_flows"
    optional: True
    section_id: "output-args"
    mode: "advanced"
  - name: save_outlines
    type: Checkbox
    label: "Save Outlines"
    description: "save outlines"
    value: False
    cli_tag: "--save_outlines"
    optional: True
    section_id: "output-args"
    mode: "advanced"
  - name: save_ncolor
    type: Checkbox
    label: "Save NColor"
    description: "save ncolor"
    value: False
    cli_tag: "--save_ncolor"
    optional: True
    section_id: "output-args"
    mode: "advanced"
  - name: save_txt
    type: Checkbox
    label: "Save TXT"
    description: "save txt"
    value: False
    cli_tag: "--save_txt"
    optional: True
    section_id: "output-args"
    mode: "advanced"

sections:
  - id: hardware-args
    label: "Hardware Arguments"
  - id: input-args
    label: "Input Arguments"
  - id: model-args
    label: "Model Arguments"
  - id: algorithm-args
    label: "Algorithm Arguments"
  - id: output-args
    label: "Output Arguments"

outputs:
  - name: output_dir
    type: Files
    label: "Download Outputs"
    description: "Directory containing the output files"
    mode: "beginner"

exec_function: 
  name: "generate_cli_command"
  script: "cellpose"
  module: "Algorithms.cellpose"
  cli_command: "python -m cellpose --verbose"
  hidden_args:
    # dummy example
    # - cli_tag: "--save_png"
    #   value: True

docker-image:
  org: cellprofiler
  name: runcellpose_no_pretrained
  tag: 0.1