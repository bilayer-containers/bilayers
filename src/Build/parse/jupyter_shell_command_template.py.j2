import subprocess
import nbformat as nbf
from IPython.core.getipython import get_ipython
from IPython.display import display, FileLink
from zipfile import ZipFile, ZIP_DEFLATED
from pathlib import Path

try:
    res = subprocess.run(cli_command.value, shell=True, check=True, stdout=None, stderr=None)
    {% raw %}
    !{cli_command.value}
    {% endraw %}
     

except Exception as e:
    error_message = str(e)
    # print(f"Error occurred: {{error_message}}")
    error_cell = nbf.v4.new_code_cell(f"# Error Details: {{error_message}}")

    ####################
    # Display the error cell
    shell = get_ipython()
    shell.payload_manager.write_payload(dict(
    source='set_next_input',
    text=error_cell['source'],
    replace=False), single=False)